<!-- Header -->
<section class="card">
  <div class="row">
    <div>
      <h1 class="h1">Équipes</h1>
      <p class="subtle">
        Saisis un <strong>nombre pair</strong> (minimum <strong>10</strong>), génère la liste puis
        modifie les noms si besoin.
      </p>
    </div>

    <div class="spacer"></div>

    <span class="chip" [class.ok]="canGenerateSchedule()" [class.warn]="!canGenerateSchedule()">
      {{ teamsCount() }} équipe(s) —
      {{ canGenerateSchedule() ? 'Prêt pour le planning' : 'Min 10 et pair' }}
    </span>
  </div>
</section>

<!-- Generator -->
<section class="card" style="margin-top: 14px">
  <div class="row" style="align-items: flex-end">
    <div style="min-width: 260px">
      <label class="subtle" style="display: block; margin-bottom: 6px">
        Nombre d’équipes (pair, ≥ 10)
      </label>

      <input
        class="input"
        [value]="teamCountInput()"
        (input)="onCountInput($event)"
        inputmode="numeric"
        pattern="[0-9]*"
        placeholder="Ex: 20"
      />

      <div class="subtle" style="margin-top: 6px">
        Statut :
        <strong>{{ isDesiredCountValid() ? 'valide' : 'invalide' }}</strong>
      </div>
    </div>

    <button class="btn" (click)="generateList()" [disabled]="loading() || !isDesiredCountValid()">
      Générer la liste
    </button>

    <button
      class="btn primary"
      (click)="createAllGenerated()"
      [disabled]="loading() || generatedNames().length === 0"
    >
      Créer toutes les équipes
    </button>

    <button
      class="btn"
      (click)="clearGenerated()"
      [disabled]="loading() || generatedNames().length === 0"
    >
      Effacer
    </button>

    <div class="spacer"></div>

    <a
      class="btn"
      routerLink="/schedule"
      [class.disabled]="!canGenerateSchedule()"
      [attr.aria-disabled]="!canGenerateSchedule()"
    >
      Aller au planning
    </a>

    <button class="btn" (click)="refresh()" [disabled]="loading()">Rafraîchir</button>

    <button
      class="btn danger"
      (click)="askDeleteAll()"
      [disabled]="loading() || teamsCount() === 0"
    >
      Supprimer toutes les équipes
    </button>
  </div>

  <div style="margin-top: 12px" *ngIf="bulkError()" class="error">{{ bulkError() }}</div>
  <div style="margin-top: 12px" *ngIf="error()" class="error">{{ error() }}</div>

  <div *ngIf="generatedNames().length > 0" style="margin-top: 14px">
    <p class="subtle" style="margin-top: 0">
      Noms par défaut = le numéro. Tu peux les modifier avant validation.
    </p>

    <div class="grid">
      <div class="mini-card" *ngFor="let name of generatedNames(); let i = index">
        <div class="mini-head">
          <span class="chip">#{{ i + 1 }}</span>
        </div>

        <input
          class="input"
          [value]="name"
          (input)="updateGeneratedName(i, $any($event.target).value)"
          placeholder="Nom de l’équipe"
        />
      </div>
    </div>
  </div>
</section>

<!-- Existing teams list -->
<section class="card" style="margin-top: 14px">
  <div class="row" style="margin-bottom: 10px">
    <h2 style="margin: 0">Équipes enregistrées</h2>
    <div class="spacer"></div>
    <span class="subtle">Suppression avec confirmation.</span>
  </div>

  <table class="table" *ngIf="teams().length > 0; else empty">
    <thead>
      <tr>
        <th>Nom</th>
        <th style="width: 1%"></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let t of teams()">
        <td>{{ t.name }}</td>
        <td>
          <button class="btn danger" (click)="askDeleteOne(t)" [disabled]="loading()">
            Supprimer
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #empty>
    <p class="subtle">Aucune équipe pour le moment.</p>
  </ng-template>
</section>

<!-- Confirm Modal -->
<dialog #confirmDialog class="confirm-dialog">
  <form method="dialog" class="confirm-card">
    <h3 style="margin-top: 0">{{ confirmTitle() }}</h3>
    <p class="subtle">{{ confirmMessage() }}</p>

    <div class="row" style="margin-top: 14px">
      <button class="btn" type="button" (click)="cancel()">Annuler</button>
      <div class="spacer"></div>
      <button class="btn" [class.danger]="confirmDanger()" type="button" (click)="confirm()">
        Confirmer
      </button>
    </div>
  </form>
</dialog>
